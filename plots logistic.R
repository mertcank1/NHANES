library(rstan)
library(ggplot2)
library(bayesplot)
test = list(m = c(1.84,1.81),N=c(2312,2487,2687,2728,2759,2787,2483,2442,2585,2787,2508,2626,4071,4205),y=c(119,178,183,340,186,337,160,280,169,342,164,251,292,475),sex=c(1,2,1,2,1,2,1,2,1,2,1,2,1,2)-1, waves=c(1,2,3,4,5,6,7,1,2,3,4,5,6,7)-1, Sigma = matrix(c(0.37,-0.07,-0.07,0.77),2,2))


test = list(m = c(1.84,1.81),N=c(2312,2487,2687,2728,2759,2787,2483,2442,2585,2787,2508,2626,4071,4205),y=c(119,178,183,340,186,337,160,280,169,342,164,251,292,475),sex=c(1,2,1,2,1,2,1,2,1,2,1,2,1,2)-1, waves_1=c(1,1,0,0,0,0,0,0,0,0,0,0,0,0),waves_2=c(0,0,1,1,0,0,0,0,0,0,0,0,0,0),waves_3=c(0,0,0,0,1,1,0,0,0,0,0,0,0,0),waves_4=c(0,0,0,0,0,0,1,1,0,0,0,0,0,0),waves_5=c(0,0,0,0,0,0,0,0,1,1,0,0,0,0),waves_6=c(0,0,0,0,0,0,0,0,0,0,1,1,0,0),waves_7=c(0,0,0,0,0,0,0,0,0,0,0,0,1,1), Sigma = matrix(c(0.37,-0.07,-.07,0.77),2,2))

model = stan_model('logistic.stan')

fýt = sampling(model, data = test,control = list(adapt_delta = 0.999,stepsize = 0.01, max_treedepth = 15))

prev<-c(0.01,0.03,0.03,0.11,0.03,0.11,0.03,0.10,0.03,0.11,0.02,0.07,0.03,0.10)
group<-c(1,2,1,2,1,2,1,2,1,2,1,2,1,2)
year<-c("2005-2006","2005-2006","2007-2008","2007-2008","2009-2010","2009-2010","2011-2012","2011-2012","2013-2014","2013-2014","2015-2016","2015-2016","2017-2020","2017-2020")
#DÜzeltprev_2.5<-c(0.02,0.06,0.02,0.07,0.02,0.08,0.02,0.06,0.02,0.07,0.02,0.07,0.02,0.08)
#DÜzeltprev_97.5<-c(0.07,0.15,0.08,0.16,0.08,0.17,0.09,0.15,0.08,0.16,0.08,0.17,0.08,0.18)
data<-cbind(prev,group,year,prev_2.5,prev_97.5)
data<-as.data.frame(data)
plot1<-ggplot(data = data, mapping = aes(y = prev, x = year ,group = group, colour=group, shape=group)) +
  geom_line(size=1.2) +
  geom_point(size=5) 

plot1+geom_errorbar(aes(ymin= prev_2.5,ymax=prev_97.5))

########################separately

prev_m<-c(0.04,0.04,0.05,0.05,0.04,0.04,0.05)
prev_f<-c(0.10,0.11,0.12,0.10,0.10,0.11,0.12)
year<-c("2005-2006","2007-2008","2009-2010","2011-2012","2013-2014","2015-2016","2017-2020")
prev_2.5_m<-c(0.02,0.02,0.02,0.02,0.02,0.02,0.02)
prev_2.5_f<-c(0.06,0.07,0.08,0.06,0.07,0.07,0.08)
prev_97.5_m<-c(0.07,0.08,0.08,0.09,0.08,0.08,0.08)
prev_97.5_f<-c(0.15,0.16,0.17,0.15,0.16,0.17,0.18)

data_m<-cbind(prev_m,year,prev_2.5_m,prev_97.5_m)
data_f<-cbind(prev_f,year,prev_2.5_f,prev_97.5_f)

plot2<-ggplot(data = data_m, aes(x =year , y = prev_m, group = 1)) +
  geom_line()+
  geom_point()

plot2+geom_errorbar(aes(ymin= prev_2.5_m,ymax=prev_97.5_m))

summary(fýt)$sum
